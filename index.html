<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VANTYX - Login</title>
    
    <!-- CSS Files -->
    <link rel="stylesheet" href="assets/css/main.css">
    <link rel="stylesheet" href="assets/css/components.css">
    <link rel="stylesheet" href="assets/css/login.css">
</head>
<body class="dark-theme">
    <!-- Header Navigation -->
    <header class="header">
        <div class="nav-container">
            <div class="logo">Login</div>
            <nav class="nav-links">
                <a href="#home" data-page="home">Home</a>
                <a href="radar.html" data-page="radar">Radar</a>
                <a href="#pro" data-page="pro">Pro</a>
            </nav>
            <div class="nav-buttons">
                <a href="#dashboard" class="btn btn-primary" data-page="dashboard">Dashboard</a>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-container">
        <!-- Left Section with Trading Chart -->
        <section class="left-section">
            <div class="chart-container">
                <div class="chart-overlay"></div>
                <div class="trading-chart" id="tradingChart">
                    <canvas id="chartCanvas"></canvas>
                </div>
            </div>
        </section>

        <!-- Right Section with Login Form -->
        <section class="right-section">
            <div class="login-container">
                <h1 class="brand-title">VANTYX</h1>
                
                <div class="login-form-wrapper">
                    <h2 class="login-title">LOGIN</h2>
                    <p class="login-subtitle">Customer ID</p>
                    
                    <form id="loginForm" class="login-form">
                        <div class="form-group">
                            <label for="customerId">Customer ID</label>
                            <input 
                                type="text" 
                                id="customerId" 
                                name="customerId" 
                                placeholder="Enter your Customer ID" 
                                required
                                autocomplete="username"
                            >
                        </div>
                        
                        <div class="form-group">
                            <label for="pin">PIN</label>
                            <input 
                                type="password" 
                                id="pin" 
                                name="pin" 
                                placeholder="Enter your PIN" 
                                required
                                autocomplete="current-password"
                            >
                        </div>
                        
                        <button type="submit" class="login-btn" id="loginBtn">
                            <span class="btn-text">LOGIN</span>
                            <span class="btn-loader" style="display: none;">
                                <span class="loader"></span>
                            </span>
                        </button>
                        
                        <div class="error-message" id="errorMessage" style="display: none;"></div>
                    </form>
                    
                    <div class="login-links">
                        <div class="signup-link">
                            <a href="register.html" data-page="signup">SIGNUP ON WEBSITE NOW</a>
                        </div>
                        
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-content">
            <div class="disclaimer">
                <p>VANTYX is not a registered broker-dealer or investment advisor. Trading involves risk 
                and may result in financial loss. Market data is provided for informational purposes 
                only and is not intended for trading or investment advice. Past performance does not 
                guarantee future results. Always do your own research before making financial decisions.</p>
            </div>
            
            <div class="footer-controls">
                <div class="language-selector">
                    <span class="country-flag">üåç Germany</span>
                    <select id="languageSelect" class="language-dropdown">
                        <option value="en">English(US)</option>
                        <option value="de">Deutsch</option>
                        <option value="fr">Fran√ßais</option>
                        <option value="es">Espa√±ol</option>
                    </select>
                </div>
                
                <div class="theme-toggle" id="themeToggle">
                    <span class="toggle-slider"></span>
                </div>
                
                <div class="company-logo">
                    <span class="logo-text">VYX</span>
                </div>
            </div>
        </div>
    </footer>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Authenticating...</p>
        </div>
    </div>

    <!-- Scripts - FIXED LOADING ORDER -->
    
    <!-- 1. Configuration must load first -->
    <script src="assets/js/config.js"></script>
    
    <!-- 2. Utilities load second -->
    <script src="assets/js/utils.js"></script>
    
    <!-- 3. User Manager loads third (depends on config and utils) -->
    <script src="assets/js/userManager.js"></script>
    
    <!-- 4. API Service loads fourth (depends on config, utils, and userManager) -->
    <script src="assets/js/apiService.js"></script>
    
    <!-- 5. Main app loads after all dependencies -->
    <script>
        // Wait for all dependencies before loading main.js
        function loadMainApp() {
            if (typeof APP_CONFIG !== 'undefined' && 
                typeof Utils !== 'undefined' && 
                typeof userManager !== 'undefined' && 
                typeof apiService !== 'undefined') {
                
                // All dependencies ready, load main.js
                const mainScript = document.createElement('script');
                mainScript.src = 'assets/js/main.js';
                mainScript.onerror = () => console.error('Failed to load main.js');
                document.body.appendChild(mainScript);
                
                // After main.js loads, then load page-specific scripts
                mainScript.onload = () => {
                    const loginScript = document.createElement('script');
                    loginScript.src = 'assets/js/login.js';
                    loginScript.onerror = () => console.error('Failed to load login.js');
                    document.body.appendChild(loginScript);
                };
            } else {
                // Dependencies not ready, try again
                setTimeout(loadMainApp, 10);
            }
        }
        
        // Start loading main app
        loadMainApp();
    </script>
    
    <!-- Fallback initialization script -->
    <script>
        // Simple login function for fallback
        window.simpleLogin = function() {
            const customerId = document.getElementById('customerId').value;
            const pin = document.getElementById('pin').value;
            const errorMessage = document.getElementById('errorMessage');
            const loadingOverlay = document.getElementById('loadingOverlay');
            const loginBtn = document.getElementById('loginBtn');
            
            console.log('Simple login function called');
            
            // Show loading
            if (loadingOverlay) {
                loadingOverlay.style.display = 'flex';
            }
            
            // Disable button
            if (loginBtn) {
                loginBtn.disabled = true;
                const btnText = loginBtn.querySelector('.btn-text');
                const btnLoader = loginBtn.querySelector('.btn-loader');
                if (btnText) btnText.style.display = 'none';
                if (btnLoader) btnLoader.style.display = 'inline-block';
            }
            
            // Hide error message
            if (errorMessage) {
                errorMessage.style.display = 'none';
                errorMessage.textContent = '';
            }
            
            // Simulate login check
            setTimeout(() => {
                // Check demo credentials
                if ((customerId === 'DEMO001' && pin === '1234') || 
                    (customerId === 'ADMIN' && pin === 'admin123')) {
                    console.log('Login successful!');
                    window.location.href = 'dashboard.html';
                } else {
                    // Show error
                    if (errorMessage) {
                        errorMessage.textContent = 'Invalid Customer ID or PIN';
                        errorMessage.style.display = 'block';
                    }
                    
                    // Hide loading
                    if (loadingOverlay) {
                        loadingOverlay.style.display = 'none';
                    }
                    
                    // Re-enable button
                    if (loginBtn) {
                        loginBtn.disabled = false;
                        const btnText = loginBtn.querySelector('.btn-text');
                        const btnLoader = loginBtn.querySelector('.btn-loader');
                        if (btnText) btnText.style.display = 'inline-block';
                        if (btnLoader) btnLoader.style.display = 'none';
                    }
                }
            }, 1000);
        };
        
        // Enhanced fallback initialization
        window.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded. Checking if all scripts loaded...');
            
            // Check if key objects exist after a delay
            setTimeout(() => {
                if (typeof APP_CONFIG === 'undefined') {
                    console.error('APP_CONFIG not loaded - check config.js');
                }
                if (typeof Utils === 'undefined') {
                    console.error('Utils not loaded - check utils.js');
                }
                if (typeof userManager === 'undefined') {
                    console.error('userManager not loaded - check userManager.js');
                }
                
                // Setup fallback login if LoginPage class doesn't exist
                const loginForm = document.getElementById('loginForm');
                const loginBtn = document.getElementById('loginBtn');
                
                if (loginForm && typeof LoginPage === 'undefined') {
                    console.log('Setting up fallback login functionality...');
                    
                    // Remove any existing event listeners
                    const newForm = loginForm.cloneNode(true);
                    loginForm.parentNode.replaceChild(newForm, loginForm);
                    
                    newForm.addEventListener('submit', function(e) {
                        e.preventDefault();
                        console.log('Form submitted via fallback');
                        window.simpleLogin();
                    });
                }
                
                // Also add click handler to button as backup
                if (loginBtn) {
                    loginBtn.addEventListener('click', function(e) {
                        if (typeof LoginPage === 'undefined') {
                            e.preventDefault();
                            console.log('Button clicked via fallback');
                            window.simpleLogin();
                        }
                    });
                }
                
                // Add Enter key support
                const inputs = document.querySelectorAll('#customerId, #pin');
                inputs.forEach(input => {
                    input.addEventListener('keypress', function(e) {
                        if (e.key === 'Enter') {
                            e.preventDefault();
                            if (typeof LoginPage === 'undefined') {
                                window.simpleLogin();
                            }
                        }
                    });
                });
                
                console.log('Fallback login setup complete');
                
                // Debug info
                console.log('=== LOGIN DEBUG INFO ===');
                console.log('APP_CONFIG exists:', typeof APP_CONFIG !== 'undefined');
                console.log('Utils exists:', typeof Utils !== 'undefined');
                console.log('userManager exists:', typeof userManager !== 'undefined');
                console.log('apiService exists:', typeof apiService !== 'undefined');
                console.log('vantyxApp exists:', typeof vantyxApp !== 'undefined');
                console.log('LoginPage exists:', typeof LoginPage !== 'undefined');
                console.log('Form element:', document.getElementById('loginForm'));
                console.log('Button element:', document.getElementById('loginBtn'));
                console.log('======================');
            }, 1000);
        });
    </script>
</body>
</html>
